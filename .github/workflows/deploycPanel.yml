name: Deploy to cPanel

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set deploy and backup paths
        run: |
          export DEPLOYPATH=/home/maawidow/public_html/
          export BACKUPPATH=/home/maawidow/backups/backup_$(date +%Y%m%d_%H%M%S)
          echo "DEPLOYPATH=$DEPLOYPATH" >> $GITHUB_ENV
          echo "BACKUPPATH=$BACKUPPATH" >> $GITHUB_ENV

      - name: Create backup directory
        run: mkdir -p $BACKUPPATH

      - name: Backup current site
        run: cp -r $DEPLOYPATH* $BACKUPPATH

      - name: Deploy new files
        run: cp -r * $DEPLOYPATH

      - name: List deployed files
        run: ls -la $DEPLOYPATH
